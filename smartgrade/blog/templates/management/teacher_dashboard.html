<!doctype html>
{% load static %}
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>Teacher Dashboard | SmartGrade</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- Base CSS -->
  <link rel="stylesheet" href="{% static 'css/base.css' %}">

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="min-h-screen bg-gray-50 text-gray-800 flex flex-col">

  <!-- ===== Header ===== -->
  <header class="bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 md:px-8 py-4 flex items-center justify-between">

      <!-- Logo -->
      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-sky-400
                    flex items-center justify-center text-white font-bold shadow">
          SG
        </div>
        <div>
          <p class="text-lg font-semibold text-gray-900">SmartGrade</p>
          <p class="text-xs text-gray-500">Teacher Dashboard</p>
        </div>
      </div>

      <!-- Navigation -->
      <nav class="flex items-center gap-3 text-xs">
        <a href="{% url 'teacher_dashboard' %}"
           class="px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-700
                  border border-indigo-200 hover:bg-indigo-100 transition">
          ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>

        <a href="{% url 'teacher_student_list' %}"
           class="px-3 py-1.5 rounded-full bg-gray-100 text-gray-700
                  border border-gray-200 hover:bg-gray-200 transition">
          ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>

        <a href="{% url 'teacher_student_import' %}"
           class="px-3 py-1.5 rounded-full bg-teal-50 text-teal-700
                  border border-teal-200 hover:bg-teal-100 transition">
          Import CSV
        </a>
      </nav>

      <!-- User -->
      <div class="flex items-center gap-3 text-xs text-gray-600">
        <span class="hidden md:inline-block px-3 py-1 rounded-full bg-gray-100 border border-gray-200">
          ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π: {{ request.user.get_full_name|default:request.user.username }}
        </span>

        <a href="{% url 'profile' %}" title="‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå"
           class="h-9 w-9 rounded-full overflow-hidden border border-slate-200
                  flex items-center justify-center bg-indigo-500 text-white
                  text-xs font-semibold shadow hover:opacity-90 transition">
          {% if user_profile.profile_image %}
            <img src="{{ user_profile.profile_image.url }}"
                  alt="avatar"
                 class="h-full w-full object-cover">
          {% else %}
            {{ request.user.get_full_name|default:request.user.username|slice:":1"|upper }}
          {% endif %}
        </a>

        <a href="{% url 'logout' %}"
           class="ml-2 inline-flex items-center px-3 py-1.5 rounded-full
                  bg-rose-500 hover:bg-rose-600 text-white text-[11px] transition">
          Logout
        </a>
      </div>

    </div>
  </header>

  <!-- ===== Main ===== -->
  <main class="flex-1 max-w-6xl mx-auto px-4 md:px-8 py-8 space-y-8">

    <!-- Overview -->
    <section class="bg-white border border-gray-200 rounded-2xl shadow-md p-6 md:p-8">
      <div class="flex items-center justify-between gap-6">
        <div>
          <h2 class="text-xl md:text-2xl font-semibold text-gray-900 mb-1">
            ‡∏†‡∏≤‡∏û‡∏£‡∏ß‡∏°‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
          </h2>
          <p class="text-sm text-gray-600">
            ‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÉ‡∏ô‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì
          </p>
        </div>

        <div class="text-right">
          <p class="text-xs text-gray-500 mb-1">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</p>
          <div class="text-4xl font-bold text-indigo-600">
            {{ total_students }}
          </div>
        </div>
      </div>
    </section>

    <!-- Risk Students -->
    <section class="bg-white border border-gray-200 rounded-2xl shadow-md p-6 md:p-7">
      <div class="flex justify-between items-center mb-4">
          <div>
            <h3 class="text-lg font-semibold text-gray-900 mb-1">
                ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏° (‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á)
            </h3>
            <p class="text-xs text-gray-500">
                ‡∏û‡∏ö‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î <span class="font-bold text-red-500">{{ risk_list|length }}</span> ‡∏Ñ‡∏ô (‡∏à‡∏≤‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î {{ total_students }} ‡∏Ñ‡∏ô)
            </p>
          </div>
      </div>

      {% if risk_list %}
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
          
          {% for item in risk_list %}
            <a href="{% url 'student_report' item.info.id %}" 
               class="group block bg-white border border-red-100 rounded-xl p-4 hover:shadow-md hover:border-red-300 transition relative overflow-hidden">
               
               <div class="absolute left-0 top-0 bottom-0 w-1.5 {% if item.risk_status == 'critical' %}bg-red-500{% else %}bg-yellow-400{% endif %} group-hover:scale-y-110 transition"></div>

               <div class="flex justify-between items-start mb-3 pl-2">
                  <div>
                      <div class="font-bold text-gray-800 group-hover:text-indigo-700 transition truncate w-32 md:w-40">
                          {{ item.info.user.get_full_name|default:item.info.user.username }}
                      </div>
                      <div class="flex items-center gap-2">
                        <div class="text-[10px] text-gray-400">ID: {{ item.info.user.username }}</div>
                        
                        {% if item.last_date %}
                        <div class="text-[9px] px-1.5 py-0.5 bg-gray-100 rounded text-gray-500 border border-gray-200">
                            {{ item.last_date|date:"d/m/y" }}
                        </div>
                        {% endif %}
                      </div>
                  </div>
                  
                  <span class="text-[10px] px-2 py-1 rounded-lg border font-semibold {{ item.risk_class }}">
                    {{ item.risk_label }}
                  </span>
               </div>

               <div class="pl-2 space-y-3">
                  <div>
                      <div class="flex justify-between text-[10px] mb-1 text-gray-500 font-medium">
                          <span>‡πÄ‡∏Ç‡πâ‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</span> <span class="{% if item.stat_att < 50 %}text-red-600 font-bold{% else %}text-gray-600{% endif %}">
                              {{ item.stat_att }}%
                          </span>
                      </div>
                      <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                          <div class="h-1.5 rounded-full transition-all duration-1000 
                                      {% if item.stat_att < 50 %}bg-red-500{% elif item.stat_att < 80 %}bg-yellow-400{% else %}bg-emerald-500{% endif %}" 
                               style="width: {{ item.stat_att }}%"></div>
                      </div>
                  </div>

                  <div>
                      <div class="flex justify-between text-[10px] mb-1 text-gray-500 font-medium">
                          <span>‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô & ‡∏á‡∏≤‡∏ô (‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î)</span>
                          <span class="{% if item.stat_score < 50 %}text-red-600 font-bold{% else %}text-gray-600{% endif %}">
                              {{ item.stat_score }}%
                          </span>
                      </div>
                      <div class="w-full bg-gray-100 rounded-full h-1.5 overflow-hidden">
                          <div class="h-1.5 rounded-full transition-all duration-1000 
                                      {% if item.stat_score < 50 %}bg-red-500{% elif item.stat_score < 80 %}bg-yellow-400{% else %}bg-blue-500{% endif %}" 
                               style="width: {{ item.stat_score }}%"></div>
                      </div>
                  </div>
               </div>
               
               <div class="mt-3 text-right">
                   <span class="text-[10px] text-gray-400 group-hover:text-indigo-500 transition flex items-center justify-end gap-1">
                       ‡∏î‡∏π‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î ‚ûî
                   </span>
               </div>
            </a>
          {% endfor %}
        </div>
      {% else %}
        <div class="flex flex-col items-center justify-center py-10 bg-gray-50 rounded-xl border-2 border-dashed border-gray-200">
           <span class="text-4xl mb-2">üéâ</span>
           <p class="text-sm text-gray-500 font-medium">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏Å‡∏•‡∏∏‡πà‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡πÉ‡∏ô‡∏£‡∏≤‡∏¢‡∏ß‡∏¥‡∏ä‡∏≤‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì</p>
           <p class="text-xs text-gray-400">‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡πÉ‡∏ô‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏õ‡∏Å‡∏ï‡∏¥</p>
        </div>
      {% endif %}
    </section>

  </main>

</body>
</html>
