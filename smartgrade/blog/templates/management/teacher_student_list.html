<!doctype html>
{% load static %}
<html lang="th">
<head>
  <meta charset="utf-8">
  <title>‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î | SmartGrade</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="{% static 'css/base.css' %}">
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-gray-50 text-gray-800 flex flex-col">

  <header class="bg-white/80 backdrop-blur border-b border-gray-200">
    <div class="max-w-6xl mx-auto px-4 md:px-8 py-4 flex items-center justify-between">

      <div class="flex items-center gap-3">
        <div class="h-10 w-10 rounded-xl bg-gradient-to-br from-indigo-500 to-sky-400 
                    flex items-center justify-center text-white font-bold shadow">
          SG
        </div>
        <div>
          <p class="text-lg font-semibold text-gray-900">SmartGrade</p>
          <p class="text-xs text-gray-500">Teacher Dashboard</p>
        </div>
      </div>

      <nav class="flex items-center gap-3 text-xs">
        <a href="{% url 'teacher_dashboard' %}"
          class="px-3 py-1.5 rounded-full bg-indigo-50 text-indigo-700 border border-indigo-200 hover:bg-indigo-100 transition">
          ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å
        </a>
        
        <a href="{% url 'teacher_student_list' %}"
          class="px-3 py-1.5 rounded-full bg-gray-100 text-gray-700 border border-gray-200 hover:bg-gray-200 transition">
          ‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î
        </a>

        <a href="{% url 'teacher_student_import' %}"
          class="px-3 py-1.5 rounded-full bg-teal-50 text-teal-700 border border-teal-200 hover:bg-teal-100 transition">
          Import CSV
        </a>

        <a href="{% url 'teacher_student_create' %}" 
          class="px-3 py-1.5 rounded-full bg-emerald-50 text-emerald-700 border border-emerald-200 hover:bg-emerald-100 transition">
          + ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
        </a>
      </nav>

      <div class="flex items-center gap-3 text-xs text-gray-600">
        <span class="hidden md:inline-block px-3 py-1 rounded-full bg-gray-100 border border-gray-200">
          ‡∏Ñ‡∏∏‡∏ì‡∏Ñ‡∏£‡∏π: {{ request.user.get_full_name|default:request.user.username }}
        </span>
        <a href="{% url 'profile' %}" title="‡∏î‡∏π‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå"
          class="h-9 w-9 rounded-full overflow-hidden border border-slate-200 flex items-center justify-center bg-indigo-500 text-white text-xs font-semibold shadow hover:opacity-90 transition">
          {% if user_profile.profile_image %}
            <img src="{{ user_profile.profile_image.url }}" alt="avatar"
                class="h-full w-full object-cover">
          {% else %}
            {{ request.user.get_full_name|default:request.user.username|slice:":1"|upper }}
          {% endif %}
        </a>
        <a href="{% url 'logout' %}"
           class="ml-2 inline-flex items-center px-3 py-1.5 rounded-full
                  bg-rose-500 hover:bg-rose-600 text-white text-[11px] transition">
          Logout
        </a>
      </div>

    </div>
  </header>

  <main class="flex-1 max-w-6xl mx-auto px-4 md:px-8 py-8">
    
    <div class="flex flex-col md:flex-row justify-between items-end md:items-center mb-6 gap-4">
      <h1 class="text-xl font-semibold text-gray-900">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</h1>
    </div>

    <div class="bg-white border border-gray-200 rounded-2xl shadow-sm p-4 mb-6">
      <form method="get" class="flex flex-col md:flex-row gap-3 items-center">
        <div class="flex-1 w-full">
            <input type="text" name="q" value="{{ search_query|default:'' }}" 
                   placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏ä‡∏∑‡πà‡∏≠ ‡∏´‡∏£‡∏∑‡∏≠ Username..." 
                   class="w-full text-sm border border-gray-300 rounded-xl px-4 py-2 focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 outline-none">
        </div>
        
        <div class="w-full md:w-auto">
            <select name="class_name" class="w-full text-sm border border-gray-300 rounded-xl px-4 py-2 outline-none bg-white">
                <option value="">‡∏ó‡∏∏‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</option>
                {% for c in all_classes %}
                <option value="{{ c }}" {% if class_filter == c %}selected{% endif %}>{{ c }}</option>
                {% endfor %}
            </select>
        </div>

        <button type="submit" class="w-full md:w-auto px-6 py-2 rounded-xl bg-gray-800 text-white text-sm hover:bg-gray-900 transition shadow">
            ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
        </button>
        {% if search_query or class_filter %}
        <a href="{% url 'teacher_student_list' %}" class="text-xs text-gray-500 underline hover:text-gray-800">‡∏•‡πâ‡∏≤‡∏á‡∏Ñ‡πà‡∏≤</a>
        {% endif %}
      </form>
    </div>

    <div class="bg-white border border-gray-200 rounded-2xl shadow-md p-4 md:p-6">
      
      {% if messages %}
        <div class="mb-4 space-y-2">
        {% for message in messages %}
          <div class="p-3 rounded-lg text-xs 
            {% if message.tags == 'success' %}bg-emerald-50 text-emerald-700 border border-emerald-200
            {% elif message.tags == 'error' %}bg-red-50 text-red-700 border border-red-200
            {% else %}bg-blue-50 text-blue-700 border border-blue-200{% endif %}">
            {{ message }}
          </div>
        {% endfor %}
        </div>
      {% endif %}

      <form method="POST" action="{% url 'teacher_student_bulk_delete' %}" id="bulkDeleteForm" onsubmit="return confirm('‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏ô‡πà‡πÉ‡∏à‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà‡∏ó‡∏µ‡πà‡∏à‡∏∞‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î? ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏∞‡∏Å‡∏π‡πâ‡∏Ñ‡∏∑‡∏ô‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ');">
        {% csrf_token %}

        <div class="mb-4 flex justify-end">
            <button type="submit" class="text-xs bg-rose-50 text-rose-600 border border-rose-200 hover:bg-rose-600 hover:text-white px-4 py-2 rounded-lg transition font-semibold flex items-center gap-2">
                <span>üóëÔ∏è ‡∏•‡∏ö‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
            </button>
        </div>

        <div class="overflow-x-auto -mx-2 md:mx-0">
          <table class="min-w-full text-xs md:text-sm text-left text-gray-800">
            <thead class="border-b border-gray-200 text-[11px] uppercase text-gray-500 bg-gray-50">
            <tr>
              <th class="px-3 py-3 rounded-tl-lg w-10 text-center">
                  <input type="checkbox" id="selectAll" class="rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
              </th>

              <th class="px-3 py-3">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ (‡∏£‡∏´‡∏±‡∏™)</th> <th class="px-3 py-3">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
              <th class="px-3 py-3 text-center">‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Ñ‡∏ß‡∏≤‡∏°‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á</th>
              <th class="px-3 py-3 text-right rounded-tr-lg">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
            </tr>
            </thead>
            <tbody class="divide-y divide-gray-100">
            {% for s in students %}
              <tr class="hover:bg-gray-50 transition group">
                
                <td class="px-3 py-3 text-center">
                    <input type="checkbox" name="student_ids" value="{{ s.id }}" class="student-checkbox rounded border-gray-300 text-indigo-600 focus:ring-indigo-500 cursor-pointer">
                </td>

                <td class="px-3 py-3 font-medium text-indigo-900">
                  {{ s.user.username }}
                </td>
                <td class="px-3 py-3 text-gray-600">
                  {{ s.class_name }}
                </td>
                <td class="px-3 py-3 text-center">
                  {% if s.risk_status == "normal" %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-[10px] font-medium bg-emerald-100 text-emerald-700 border border-emerald-200">‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢</span>
                  {% elif s.risk_status == "warning" %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-[10px] font-medium bg-yellow-100 text-yellow-700 border border-yellow-200">‡πÄ‡∏ù‡πâ‡∏≤‡∏£‡∏∞‡∏ß‡∏±‡∏á</span>
                  {% elif s.risk_status == "critical" %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-[10px] font-medium bg-red-100 text-red-700 border border-red-200">‡πÄ‡∏™‡∏µ‡πà‡∏¢‡∏á‡∏™‡∏π‡∏á</span>
                  {% else %}
                     <span class="text-gray-400 text-[10px]">-</span>
                  {% endif %}
                </td>
                <td class="px-3 py-3 text-right space-x-2">
                   <a href="{% url 'teacher_student_detail' s.id %}" class="text-indigo-600 hover:text-indigo-800 font-semibold bg-indigo-50 px-2 py-1 rounded-md transition">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</a>
                   <a href="{% url 'teacher_student_delete' s.id %}" onclick="return confirm('‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô {{ s.user.username }}?')" class="text-gray-400 hover:text-red-600 px-2 py-1 transition">‡∏•‡∏ö</a>
                </td>
              </tr>
            {% empty %}
              <tr>
                <td colspan="5" class="px-3 py-8 text-center text-sm text-gray-500">
                  ‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ô‡∏±‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏ô
                </td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
        </div>
      </form></div>
  </main>

  <script>
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.student-checkbox');
        checkboxes.forEach(checkbox => {
            checkbox.checked = this.checked;
        });
    });
  </script>

</body>
</html>